[[assert-with-assertequals]]
== Assert with assertEquals

This section describes how to assert `ProxyTestDataSource` with simple `assertEquals` from JUnit or TestNG.

=== DataSource

[source,java,indent=0]
[subs="verbatim,attributes"]
----
    ProxyTestDataSource ds = new ProxyTestDataSource();
    // perform logic with datasource...

    // execution count
    assertEquals(3, ds.getQueryExecutions().size());
    assertEquals(3, ds.getStatements().size());
    assertEquals(3, ds.getBatchStatements().size());
    assertEquals(3, ds.getPrepareds().size());
    assertEquals(3, ds.getBatchPrepareds().size());
    assertEquals(3, ds.getCallables().size());
    assertEquals(3, ds.getBatchCallables().size());
----

=== QueryExecutions

[source,java,indent=0]
[subs="verbatim,attributes"]
----
    ProxyTestDataSource ds = new ProxyTestDataSource();
    // perform logic with datasource...

    // each execution
    QueryExecution qe = ds.getQueryExecutions().get(0);
    assertTrue(qe.isSuccess());
    assertTrue(qe.isBatch());
    assertTrue(qe instanceof StatementExecution);
    assertTrue(qe instanceof StatementBatchExecution);
    assertTrue(qe instanceof PreparedExecution);
    assertTrue(qe instanceof PreparedExecution);
    assertTrue(qe instanceof CallableExecution);
    assertTrue(qe instanceof CallableBatchExecution);
----

=== Statement

[source,java,indent=0]
[subs="verbatim,attributes"]
----
    ProxyTestDataSource ds = new ProxyTestDataSource();
    // perform logic with datasource...

    StatementExecution se = ds.getFirstStatement();

    assertTrue(se.isSuccess());
    assertFalse(se.isSuccess());

    assertEquals("FOO", se.getQuery());
----


=== Batch Statement

[source,java,indent=0]
[subs="verbatim,attributes"]
----
    ProxyTestDataSource ds = new ProxyTestDataSource();
    // perform logic with datasource...

    StatementBatchExecution sbe = ds.getFirstBatchStatement();

    assertTrue(sbe.isSuccess());
    assertFalse(sbe.isSuccess());

    List<String> queries = sbe.getQueries();
    assertEquals(3, queries.size());
    assertEquals("FOO", queries.get(0));
----

=== Prepared Statement


[source,java,indent=0]
[subs="verbatim,attributes"]
----
    ProxyTestDataSource ds = new ProxyTestDataSource();
    // perform logic with datasource...

    PreparedExecution pe = ds.getFirstPrepared();

    assertTrue(pe.isSuccess());
    assertFalse(pe.isSuccess());

    assertEquals("FOO", pe.getQuery());

    // parameter indexes
    List<Integer> indexes = pe.getParamIndexes();
    assertEquals(2, indexes.size());
    assertEquals(Integer.valueOf(1), indexes.get(0));
    assertEquals(Integer.valueOf(2), indexes.get(1));

    // parameters
    Map<Integer, Object> paramsByIndex = pe.getSetParamsByIndex();
    assertEquals(100, paramsByIndex.get(1));
    assertEquals("FOO", paramsByIndex.get(2));

    // setNull parameters
    Map<Integer, Integer> setNullByIndex = pe.getSetNullParamsByIndex();
    assertEquals(Integer.valueOf(Types.VARCHAR), setNullByIndex.get(1));
    assertTrue(setNullByIndex.containsKey(2));
----

=== Batch Prepared Statement

[source,java,indent=0]
[subs="verbatim,attributes"]
----
    ProxyTestDataSource ds = new ProxyTestDataSource();
    // perform logic with datasource...

    PreparedBatchExecution pbe = ds.getFirstBatchPrepared();

    assertTrue(pbe.isSuccess());
    assertFalse(pbe.isSuccess());

    assertEquals("FOO", pbe.getQuery());

    // check batch executions
    List<BatchExecutionEntry> batchEntries = pbe.getBatchExecutionEntries();
    assertEquals(3, batchEntries.size());

    BatchExecutionEntry entry = batchEntries.get(0);
    assertTrue(entry instanceof PreparedBatchExecutionEntry);

    PreparedBatchExecutionEntry preparedBatchEntry = (PreparedBatchExecutionEntry) entry;

    // parameter indexes
    List<Integer> indexes = preparedBatchEntry.getParamIndexes();
    assertEquals(3, indexes.size());
    assertEquals(Integer.valueOf(10), indexes.get(0));

    // parameters
    Map<Integer, Object> paramsByIndex = preparedBatchEntry.getSetParamsByIndex();
    assertEquals(100, paramsByIndex.get(1));
    assertEquals("FOO", paramsByIndex.get(2));

    // setNull parameters
    Map<Integer, Integer> setNullByIndex = preparedBatchEntry.getSetNullParamsByIndex();
    assertEquals(Integer.valueOf(Types.VARCHAR), setNullByIndex.get(1));
    assertTrue(setNullByIndex.containsKey(2));
----


=== Callable Statement

[source,java,indent=0]
[subs="verbatim,attributes"]
----
    ProxyTestDataSource ds = new ProxyTestDataSource();
    // perform logic with datasource...

    CallableExecution ce = ds.getFirstCallable();

    assertTrue(ce.isSuccess());
    assertFalse(ce.isSuccess());

    assertEquals("FOO", ce.getQuery());

    // parameter names/indexes
    List<Integer> indexes = ce.getParamIndexes();
    assertEquals(2, indexes.size());
    assertEquals(Integer.valueOf(1), indexes.get(0));
    assertEquals(Integer.valueOf(2), indexes.get(1));

    List<String> names = ce.getParamNames();
    assertEquals(2, names.size());
    assertEquals("key1", names.get(0));
    assertEquals("key2", names.get(1));


    // registerOut names/indexes
    List<Integer> outIndexes = ce.getOutParamIndexes();
    assertEquals(1, outIndexes.size());
    assertEquals(Integer.valueOf(1), outIndexes.get(0));

    List<String> outNames = ce.getOutParamNames();
    assertEquals(1, outNames.size());
    assertEquals("key1", outNames.get(0));


    // parameters
    Map<Integer, Object> paramsByIndex = ce.getSetParamsByIndex();
    assertEquals(100, paramsByIndex.get(1));
    assertEquals("FOO", paramsByIndex.get(2));

    Map<String, Object> paramsByName = ce.getSetParamsByName();
    assertEquals(100, paramsByName.get("key1"));
    assertEquals("FOO", paramsByName.get("key2"));


    // setNull parameters
    Map<Integer, Integer> setNullByIndex = ce.getSetNullParamsByIndex();
    assertEquals(Integer.valueOf(Types.VARCHAR), setNullByIndex.get(1));
    assertTrue(setNullByIndex.containsKey(2));

    Map<String, Integer> setNullByName = ce.getSetNullParamsByName();
    assertEquals(Integer.valueOf(Types.VARCHAR), setNullByName.get("key1"));
    assertTrue(setNullByName.containsKey("key2"));


    // registerOut parameters
    Map<Integer, Object> outParamsByIndex = ce.getOutParamsByIndex();
    assertEquals(Types.INTEGER, outParamsByIndex.get(0));

    Map<String, Object> outParamsByName = ce.getOutParamsByName();
    assertEquals(JDBCType.INTEGER, outParamsByName.get("key"));
----


=== Batch Callable Statement

[source,java,indent=0]
[subs="verbatim,attributes"]
----
    ProxyTestDataSource ds = new ProxyTestDataSource();
    // perform logic with datasource...

    CallableBatchExecution cbe = ds.getFirstBatchCallable();

    assertTrue(cbe.isSuccess());
    assertFalse(cbe.isSuccess());

    assertEquals("FOO", cbe.getQuery());


    // check batch executions
    List<BatchExecutionEntry> batchEntries = cbe.getBatchExecutionEntries();
    assertEquals(3, batchEntries.size());

    BatchExecutionEntry entry = batchEntries.get(0);
    assertTrue(entry instanceof CallableBatchExecutionEntry);

    CallableBatchExecutionEntry callableBatchEntry = (CallableBatchExecutionEntry) entry;


    // parameter names/indexes
    List<String> names = callableBatchEntry.getParamNames();
    assertEquals(3, names.size());
    assertEquals("foo", names.get(0));

    List<Integer> indexes = callableBatchEntry.getParamIndexes();
    assertEquals(3, indexes.size());
    assertEquals(Integer.valueOf(10), indexes.get(0));


    // registerOut names/indexes
    List<Integer> outIndexes = callableBatchEntry.getOutParamIndexes();
    assertEquals(1, outIndexes.size());
    assertEquals(Integer.valueOf(1), outIndexes.get(0));

    List<String> outNames = callableBatchEntry.getOutParamNames();
    assertEquals(1, outNames.size());
    assertEquals("key1", outNames.get(0));


    // parameters
    Map<String, Object> paramsByName = callableBatchEntry.getSetParamsByName();
    assertEquals(100, paramsByName.get("key1"));
    assertEquals("FOO", paramsByName.get("key2"));

    Map<Integer, Object> paramsByIndex = callableBatchEntry.getSetParamsByIndex();
    assertEquals(100, paramsByIndex.get(1));
    assertEquals("FOO", paramsByIndex.get(2));


    // setNull parameters
    Map<String, Integer> setNullByName = callableBatchEntry.getSetNullParamsByName();
    assertEquals(Integer.valueOf(Types.VARCHAR), setNullByName.get("key1"));
    assertTrue(setNullByName.containsKey("key2"));

    Map<Integer, Integer> setNullByIndex = callableBatchEntry.getSetNullParamsByIndex();
    assertEquals(Integer.valueOf(Types.VARCHAR), setNullByIndex.get(1));
    assertTrue(setNullByIndex.containsKey(2));


    // registerOut parameters
    Map<String, Object> outParamByName = callableBatchEntry.getOutParamsByName();
    assertEquals(Types.VARCHAR, outParamByName.get("key1"));
    assertEquals(JDBCType.INTEGER, outParamByName.get("key2"));

    Map<Integer, Object> outParamByIndex = callableBatchEntry.getOutParamsByIndex();
    assertEquals(Types.VARCHAR, outParamByIndex.get(1));
    assertEquals(JDBCType.INTEGER, outParamByIndex.get(2));
----
